### 分布式计算框架MapReduce

####   MapReduce介绍

- Hadoop MapReduce是一个分布式计算框架，用于轻松编写**分布式应用程序**，这些应用程序以可靠，容错的方式并行处理大型硬件集群（数千个节点）上的大量数据（多TB数据集）。
- MapReduce是一种面向海量数据处理的一种指导思想，也是一种用于对大规模数据进行分布式计算的编程模型，由于计算时长及效率不高，所以现在基于大数据的分布式计算框架MapReduce并不常用，但是有些软件依然依赖于MapReduce设计思想。

####  MapReduce主要功能

1.数据划分和计算任务调度；
2.数据/代码互定位；
3.系统优化；
4.出错检测和恢复。

####  MapReduce具有的特点

1.优点

（1）MapReduce 易于编程
它简单的实现一些接口，就可以完成一个分布式程序，这个分布式程序可以分布到大量廉价的 PC 机器上运行。也就是说你写一个分布式程序，跟写一个简单的串行程序是一模一样的。就是因为这个特点使得 MapReduce 编程变得非常流行。
（2） 良好的扩展性
当你的计算资源不能得到满足的时候，你可以通过简单的增加机器来扩展它的计算能力。
（3）高容错性
MapReduce 设计的初衷就是使程序能够部署在廉价的 PC 机器上，这就要求它具有很高的容错性。比如其中一台机器挂了，它可以把上面的计算任务转移到另外一个节点上运行，不至于这个任务运行失败，而且这个过程不需要人工参与，而完全是由Hadoop内部完成的。
（4）适合 PB 级以上海量数据的离线处理
可以实现上千台服务器集群并发工作，提供数据处理能力
2.缺点

（1）不擅长实时计算
MapReduce 无法像 MySQL 一样，在毫秒或者秒级内返回结果。
（2）不擅长流式计算
流式计算的输入数据是动态的，而 MapReduce 的输入数据集是静态的，不能动态变化。
这是因为 MapReduce 自身的设计特点决定了数据源必须是静态的。
（3）不擅长 DAG （有向 无环 图）计算
多个应用程序存在依赖关系，后一个应用程序的输入为前一个的输出。在这种情况下，
MapReduce 并不是不能做，而是使用后，每个 MapReduce 作业的输出结果都会写入到磁盘，
会造成大量的磁盘 IO，导致性能非常的低下。

#### MapReduce进程

一个完整的MapReduce程序在分布式运行时有三类实例进程：

（1）MrAppMaster：负责整个程序的过程调度及状态协调。

（2）Map Task：负责map阶段的整个数据处理流程。

（3）Reduce Task：负责reduce阶段的整个数据处理流程。

#### MapReduce执行流程

第一步：读取文件，解析成为key，value对
第二步：自定义map逻辑接受k1,v1，转换成为新的k2,v2输出
第三步：分区Partition。将相同key的数据发送到同一个reduce里面去
第四步：排序，map阶段分区内的数据进行排序
第五步：combiner。调优过程，对数据进行map阶段的合并
第六步：将环形缓冲区的数据进行溢写到本地磁盘小文件
第七步：归并排序，对本地磁盘溢写小文件进行归并排序
第八步：等待reduce Task启动线程来进行拉取数据
第九步：reduce Task启动线程拉取属于自己分区的数据
第十步：从map Task拉取回来的数据继续进行归并排序
第十一步：进行grouping Comparator分组操作
第十二步：调用reduce逻辑，写出数据
第十三步：通过output Format进行数据输出，写到文件，一个reduce Task对应一个文件。
